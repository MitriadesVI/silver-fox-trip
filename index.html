<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Los Viajes de la Zorra</title>
  <style>
    html,body{margin:0;height:100%;background:radial-gradient(ellipse at top,#0b2a3a 0%,#061b27 60%,#051420 100%);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
    /* Contenedor ocupa toda la pantalla (m√≥vil) */
    #gameContainer{width:100vw;height:100vh;margin:0 auto;padding:0;box-sizing:border-box}
    /* En desktop dejamos el marco bonito */
    @media (min-width: 600px){
      #gameContainer{max-width:520px;max-height:calc(100vh - 24px);padding:12px}
    }
    canvas{display:block;margin:0 auto;border-radius:14px;box-shadow:0 0 0 4px #00e0e0, 0 0 28px rgba(0,224,224,.35) inset}
  </style>
</head>
<body>
  <div id="gameContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
  <script>
  const GAME_W=480,GAME_H=800;
  const LANES=[80,240,400];
  const CLAMP_X={min:50,max:430};

  // Estado
  class GameState{
    reset(){
      this.life=100;           // Vida inicial
      this.nitro=100;
      this.score=0;
      this.level=1;
      this.baseSpeed=220;
      this.playerSpeed=320;
      this.nitroActive=false;
      // NUEVO: Sistema de estad√≠sticas
      this.stats = {
        venecasRecogidas: 0,
        powerupsRecogidos: 0,
        cervezasChocadas: 0,
        policiasEsquivados: 0,
        policiasChocados: 0
      };
    }
  }
  const gameState=new GameState(); gameState.reset();

  /* ================== PRELOAD ================== */
  class Preload extends Phaser.Scene{
    constructor(){super('Preload')}
    preload(){
      // Assets
      this.load.image('road','assets/road.png');
      this.load.image('player','assets/car.png');
      this.load.image('beer','assets/stella.png');      // cerveza Stella
      this.load.image('whisky','assets/whisky.png');
      this.load.image('police','assets/police.png');
      this.load.image('motopolice','assets/motopolice.png'); // moto
      this.load.image('powerup','assets/powerup.png');  // bolsita (vida)
      this.load.image('veneca','assets/veneca.png');    // power-up (nitro)
      this.load.image('mainmenu','assets/mainmenu.png');// fondo del men√∫
      // NUEVO: Asset para explosi√≥n
      this.load.image('explosion','assets/explosion.png');
      // NUEVO: Nuevos tipos de botellas
      this.load.image('tapaverde','assets/tapaverde.png');
      this.load.image('clubdorada','assets/clubdorada.png');
      this.load.image('aguardientereal','assets/aguardientereal.png');
    }
    create(){ this.scene.start('MainMenu'); }
  }

  /* ================== MEN√ö ================== */
  class MainMenu extends Phaser.Scene{
    constructor(){super('MainMenu')}
    create(){
      // Fondo con cover
      const bg = this.add.image(GAME_W/2, GAME_H/2, 'mainmenu');
      const s = Math.max(GAME_W / bg.width, GAME_H / bg.height);
      bg.setScale(s).setScrollFactor(0);

      this.add.rectangle(GAME_W/2, GAME_H/2, GAME_W, GAME_H, 0x000000, 0.25);

      this.add.text(GAME_W/2,70,'LOS VIAJES DE LA ZORRA',{fontSize:'24px',fill:'#00ffff',stroke:'#001d1d',strokeThickness:6}).setOrigin(0.5);

      const btn=this.add.text(GAME_W/2,300,'JUGAR',{
        fontSize:'26px',fill:'#ffff00',backgroundColor:'#006666',
        padding:{x:20,y:10},stroke:'#ffffff',strokeThickness:2
      }).setOrigin(0.5).setInteractive({useHandCursor:true});
      btn.on('pointerdown',()=>this.scene.start('Game'));

      this.add.text(GAME_W/2,360,'M√≥vil: arrastra el coche o toca los lados.\nBot√≥n NITRO a la derecha.',{
        fontSize:'14px',fill:'#e0ffff',align:'center'
      }).setOrigin(0.5);
    }
  }

  /* ================== JUEGO ================== */
  class Game extends Phaser.Scene{
    constructor(){super('Game')}
    init(){
      gameState.reset();
      this.invuln=false;
      this.invulnTween=null;   // para no dejar alpha colgada
      this.dragging=false;
      this.leftPressed=false; this.rightPressed=false;
      this.timers={obs:0,pow:0,ven:0,pol:0,moto:0,newBottles:0}; // Timer unificado para nuevas botellas
    }
    create(){
      // Carretera
      this.road=this.add.tileSprite(GAME_W/2,GAME_H/2,GAME_W,GAME_H,'road');

      // Jugador (tama√±o antiguo + hitbox justa)
      this.player = this.physics.add.sprite(GAME_W/2, GAME_H - 120, 'player').setDepth(2);
      this.player.setScale(0.20);
      const dw=this.player.displayWidth, dh=this.player.displayHeight;
      const bw=dw*0.42, bh=dh*0.60;
      this.player.body.setSize(bw,bh);
      this.player.body.setOffset((dw-bw)/2,(dh-bh)/2);
      this.player.setAlpha(1);

      // Grupos
      this.beers=this.physics.add.group();
      this.whiskys=this.physics.add.group();
      // NUEVO: Grupos para las nuevas botellas
      this.tapaverdes=this.physics.add.group();    // zigzag
      this.clubdoradas=this.physics.add.group();   // diagonal  
      this.aguardientes=this.physics.add.group();  // rebote lateral
      this.powerups=this.physics.add.group();    // powerup.png (vida)
      this.venecas=this.physics.add.group();     // veneca.png (nitro)
      this.polices=this.physics.add.group();
      this.motos=this.physics.add.group();

      // Colisiones
      this.physics.add.overlap(this.player,this.beers,(p,o)=>this.handleHit(p,o),null,this);
      this.physics.add.overlap(this.player,this.whiskys,(p,o)=>this.handleHit(p,o),null,this);
      // NUEVO: Colisiones para las nuevas botellas
      this.physics.add.overlap(this.player,this.tapaverdes,(p,o)=>this.handleHit(p,o),null,this);
      this.physics.add.overlap(this.player,this.clubdoradas,(p,o)=>this.handleHit(p,o),null,this);
      this.physics.add.overlap(this.player,this.aguardientes,(p,o)=>this.handleHit(p,o),null,this);
      this.physics.add.overlap(this.player,this.polices,(p,o)=>this.handleHit(p,o),null,this);
      this.physics.add.overlap(this.player,this.motos,(p,o)=>this.handleHit(p,o),null,this);
      this.physics.add.overlap(this.player,this.powerups,(p,o)=>this.handleCollectPowerUp(p,o),null,this);
      this.physics.add.overlap(this.player,this.venecas,(p,o)=>this.handleCollectVeneca(p,o),null,this);

      // HUD (container correcto)
      this.hud = this.add.container(0, 0).setDepth(10);
      const hudBg = this.add.rectangle(0, 0, GAME_W, 90, 0x000d0d, 0.45).setOrigin(0);
      this.hud.add(hudBg);

      this.txtLife  = this.add.text(16, 12, 'Vida: 100', { fontSize:'18px', fill:'#00ffbf' });
      this.txtScore = this.add.text(16, 34, 'Puntos: 0', { fontSize:'18px', fill:'#ffffff' });
      this.txtLevel = this.add.text(16, 56, 'Nivel: 1',  { fontSize:'18px', fill:'#ffde59' });
      const nitroLbl = this.add.text(320, 10, 'Nitro',   { fontSize:'14px', fill:'#aaffff' });
      const vidaLbl  = this.add.text(320, 44, 'Vida',    { fontSize:'14px', fill:'#aaffff' });

      this.barNitroBg = this.add.rectangle(320, 28, 140, 12, 0x003333).setOrigin(0,0);
      this.barNitro   = this.add.rectangle(320, 28, 140, 12, 0x00ffff).setOrigin(0,0);
      this.barLifeBg  = this.add.rectangle(320, 62, 140, 12, 0x330000).setOrigin(0,0);
      this.barLife    = this.add.rectangle(320, 62, 140, 12, 0xff4d4d).setOrigin(0,0);

      this.hud.add([ this.txtLife, this.txtScore, this.txtLevel,
        nitroLbl, vidaLbl, this.barNitroBg, this.barNitro, this.barLifeBg, this.barLife ]);

      // Controles
      this.cursors=this.input.keyboard.createCursorKeys();
      this.keyShift=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT);

      // Zonas t√°ctiles
      this.leftZone=this.add.zone(0,100,GAME_W/2-40,GAME_H-160).setOrigin(0,0).setInteractive();
      this.rightZone=this.add.zone(GAME_W/2+40,100,GAME_W/2-40,GAME_H-160).setOrigin(0,0).setInteractive();
      this.leftZone.on('pointerdown',()=>this.leftPressed=true);
      this.leftZone.on('pointerup',()=>this.leftPressed=false);
      this.leftZone.on('pointerout',()=>this.leftPressed=false);
      this.rightZone.on('pointerdown',()=>this.rightPressed=true);
      this.rightZone.on('pointerup',()=>this.rightPressed=false);
      this.rightZone.on('pointerout',()=>this.rightPressed=false);

      // ARREGLADO: Arrastre del coche SIN interferir con bot√≥n nitro
      this.input.on('pointerdown',(p)=>{
        // Ignorar si toca el √°rea del bot√≥n nitro
        if(p.x > GAME_W-110 && p.y > GAME_H-110) return;
        this.dragging=true; 
        this.player.x=Phaser.Math.Clamp(p.x,CLAMP_X.min,CLAMP_X.max);
      });
      this.input.on('pointermove',(p)=>{
        if(this.dragging && !(p.x > GAME_W-110 && p.y > GAME_H-110)){
          this.player.x=Phaser.Math.Clamp(p.x,CLAMP_X.min,CLAMP_X.max);
        }
      });
      this.input.on('pointerup',()=>{this.dragging=false;});

      // Bot√≥n Nitro
      this.nitroBtn=this.add.rectangle(GAME_W-70,GAME_H-70,80,44,0x006666,0.6).setStrokeStyle(2,0x00ffff).setInteractive().setDepth(20);
      this.add.text(this.nitroBtn.x,this.nitroBtn.y,'NITRO',{fontSize:'14px',color:'#fff'}).setOrigin(0.5).setDepth(21);
      this.nitroHeld=false;
      this.nitroBtn.on('pointerdown',()=>this.nitroHeld=true);
      this.nitroBtn.on('pointerup',()=>this.nitroHeld=false);
      this.nitroBtn.on('pointerout',()=>this.nitroHeld=false);
    }

    // Spawns
    spawnItem(key, velocity, scale, group, startY=-50){
      const x=Phaser.Utils.Array.GetRandom(LANES);
      const spr=group.create(x,startY,key);
      spr.setVelocityY(velocity + gameState.level*20);
      spr.setScale(scale);
      return spr;
    }
    spawnBeer(){
      const it=this.spawnItem('beer',200,0.15,this.beers);
      it.setData('damage',{life:-20}); // Stella ‚àí20
    }
    spawnWhisky(){
      const it=this.spawnItem('whisky',240,0.15,this.whiskys);
      it.setData('damage',{life:-25}); // Whisky ‚àí25
    }
    spawnPolice(){
      const it=this.spawnItem('police',280,0.18,this.polices);
      it.setData('damage',{life:-35}); // Polic√≠a ‚àí35
      it.setData('isPolice',true);
      it.setData('lateralSpeed',130 + gameState.level*15);
    }
    // Moto desde abajo; a veces persigue
    spawnMotoPolice(){
      if(gameState.level<2) return;
      const it=this.spawnItem('motopolice',-220,0.20,this.motos,850); // sube
      it.setData('damage',{life:-35});
      it.setData('chase', Math.random()<0.35); // ocasional
      return it;
    }
    // Bolsita: SIEMPRE VIDA y NO rota
    spawnPower(){
      const it=this.spawnItem('powerup',180,0.12,this.powerups);
      it.setAngle(0); // sin rotaci√≥n
      return it;
    }
    // Veneca: nitro y puntos
    spawnVeneca(){
      const it=this.spawnItem('veneca',180,0.14,this.venecas);
      return it;
    }

    // NUEVAS BOTELLAS CON PATRONES √öNICOS
    spawnTapaVerde(){
      const it=this.spawnItem('tapaverde',200,0.15,this.tapaverdes);
      it.setData('damage',{life:-15}); // Tapa Verde -15
      it.setData('zigzag',{amplitude:80, frequency:0.003, baseX:it.x});
      return it;
    }
    spawnClubDorada(){
      const it=this.spawnItem('clubdorada',180,0.16,this.clubdoradas);
      it.setData('damage',{life:-18}); // Club Dorada -18
      const direction = Math.random() < 0.5 ? -1 : 1;
      it.setVelocityX(120 * direction); // Movimiento diagonal
      return it;
    }
    spawnAguardienteReal(){
      const it=this.spawnItem('aguardientereal',220,0.14,this.aguardientes);
      it.setData('damage',{life:-22}); // Aguardiente Real -22
      it.setData('bounce',{speed:150, direction:1}); // Rebote lateral
      return it;
    }

    handleHit(player,item){
      if(this.invuln){ item.destroy(); return; }
      const data=item.getData('damage')||{life:-10};
      const texture = item.texture.key;
      
      // NUEVO: Explosi√≥n para polic√≠as
      if(texture === 'police' || texture === 'motopolice') {
        this.createExplosion(item.x, item.y);
        // Shake de c√°mara m√°s fuerte para polic√≠as
        this.cameras.main.shake(300, 0.02);
      }
      
      item.destroy();

      // Conteo de estad√≠sticas seg√∫n tipo de objeto
      if(texture === 'beer' || texture === 'whisky') {
        gameState.stats.cervezasChocadas++;
      } else if(texture === 'police') {
        gameState.stats.policiasChocados++;
      } else if(texture === 'motopolice') {
        gameState.stats.policiasChocados++; // las motos tambi√©n cuentan como polic√≠as
      }

      gameState.life=Phaser.Math.Clamp(gameState.life+data.life,0,100);

      // Invulnerabilidad breve ‚Äì evitamos "alpha" colgada
      this.invuln=true;
      if(this.invulnTween){ this.invulnTween.stop(); this.tweens.killTweensOf(this.player); }
      this.player.setAlpha(1);
      this.invulnTween = this.tweens.add({
        targets:this.player, alpha:0.25, yoyo:true, repeat:6, duration:90,
        onComplete:()=>{ this.player.setAlpha(1); this.invulnTween=null; }
      });
      this.time.delayedCall(800,()=>{ this.invuln=false; this.player.setAlpha(1); });

      if(gameState.life<=0){ this.gameOver(); }
    }
    // PowerUp: SIEMPRE vida +25
    handleCollectPowerUp(player,power){
      power.destroy();
      gameState.life=Math.min(100,gameState.life+25);
      gameState.score+=200;
      // NUEVO: Conteo de powerups recogidos
      gameState.stats.powerupsRecogidos++;
      this.cameras.main.flash(180,255,255,255);
    }
    // Veneca: nitro +40 y puntos
    handleCollectVeneca(player,p){
      p.destroy();
      gameState.nitro=Math.min(100,gameState.nitro+40);
      gameState.score+=200;
      // NUEVO: Conteo de venecas recogidas
      gameState.stats.venecasRecogidas++;
      this.cameras.main.flash(120,0,255,180);
    }

    // NUEVO: Sistema de explosiones
    createExplosion(x, y) {
      const explosion = this.add.sprite(x, y, 'explosion').setDepth(5);
      explosion.setScale(0.3);
      explosion.setAlpha(0.9);
      
      // Animaci√≥n de explosi√≥n
      this.tweens.add({
        targets: explosion,
        scaleX: 0.8,
        scaleY: 0.8,
        alpha: 0,
        duration: 400,
        ease: 'Power2',
        onComplete: () => explosion.destroy()
      });
      
      // Flash rojo para explosiones
      this.cameras.main.flash(200, 255, 100, 100);
    }

    update(time,dtMs){
      const dt=dtMs/1000;

      // NUEVO: Sistema de niveles autom√°tico basado en puntuaci√≥n
      gameState.level = Math.floor(gameState.score / 2000) + 1;

      // Scroll carretera
      const scroll=(gameState.baseSpeed + (gameState.nitroActive&&gameState.nitro>0?220:0))*dt;
      this.road.tilePositionY -= scroll;

      // ARREGLADO: Movimiento jugador CON nitro real
      let vx=0;
      if(this.cursors.left?.isDown||this.leftPressed) vx-=gameState.playerSpeed;
      if(this.cursors.right?.isDown||this.rightPressed) vx+=gameState.playerSpeed;
      
      // NUEVO: Aplicar multiplicador de velocidad cuando nitro est√° activo
      const speedMultiplier = gameState.nitroActive && gameState.nitro > 0 ? 1.8 : 1.0;
      const finalSpeed = vx * speedMultiplier;
      
      this.player.x=Phaser.Math.Clamp(this.player.x+finalSpeed*dt,CLAMP_X.min,CLAMP_X.max);
      this.player.setVelocity(0);

      // Nitro
      gameState.nitroActive=this.nitroHeld||this.keyShift?.isDown;
      if(gameState.nitroActive && gameState.nitro>0){
        gameState.nitro=Math.max(0,gameState.nitro-25*dt);
      }else{
        gameState.nitroActive=false;
        gameState.nitro=Math.min(100,gameState.nitro+10*dt);
      }

      // Spawns - REBALANCEADOS para evitar saturaci√≥n
      this.timers.obs+=dtMs; this.timers.pow+=dtMs; this.timers.ven+=dtMs; 
      this.timers.pol+=dtMs; this.timers.moto+=dtMs; this.timers.newBottles+=dtMs;
      
      const base=800 - gameState.level*25; // M√°s espaciado entre obst√°culos
      
      // Botellas b√°sicas (menos frecuentes)
      if(this.timers.obs>Math.max(400,base)){ 
        this.timers.obs=0; 
        if(Math.random()<0.4) this.spawnBeer();
        else this.spawnWhisky();
      }
      
      // NUEVAS BOTELLAS - spawn alternativo para variedad
      if(this.timers.newBottles>Math.max(600,base*0.8)){ 
        this.timers.newBottles=0; 
        const rand = Math.random();
        if(rand < 0.33) this.spawnTapaVerde();
        else if(rand < 0.66) this.spawnClubDorada(); 
        else this.spawnAguardienteReal();
      }
      
      if(this.timers.pow>1800){ this.timers.pow=0; this.spawnPower(); } // Menos powerups
      if(this.timers.ven>5000){ this.timers.ven=0; this.spawnVeneca(); } // Menos venecas
      if(this.timers.pol>(6000 - Math.min(3500,gameState.level*200))){ this.timers.pol=0; this.spawnPolice(); }
      if(this.timers.moto>(3500 - Math.min(2000,gameState.level*250))){ this.timers.moto=0; this.spawnMotoPolice(); }

      // IA Polic√≠a
      this.updatePoliceAI();
      this.updateMotoAI();
      
      // NUEVO: Patrones de movimiento √∫nicos para las nuevas botellas
      this.updateBottlePatterns();

      // NUEVO: Conteo de polic√≠as esquivados cuando pasan la pantalla
      this.polices.children.iterate(pol => {
        if(pol && pol.y > GAME_H + 80) {
          gameState.stats.policiasEsquivados++;
        }
      });
      this.motos.children.iterate(moto => {
        if(moto && moto.y > GAME_H + 80) {
          gameState.stats.policiasEsquivados++; // las motos tambi√©n cuentan como polic√≠as esquivados
        }
      });

      // Puntuaci√≥n y nivel
      gameState.score += Math.floor(40*dt) * (gameState.nitroActive?2:1);
      // HUD
      this.txtLife.setText(`Vida: ${Math.round(gameState.life)}`);
      this.txtScore.setText(`Puntos: ${gameState.score}`);
      this.txtLevel.setText(`Nivel: ${gameState.level}`);
      this.barNitro.width=140*(gameState.nitro/100);
      this.barLife.width=140*(gameState.life/100);

      // Limpieza - ACTUALIZADO con nuevas botellas
      [this.beers,this.whiskys,this.tapaverdes,this.clubdoradas,this.aguardientes,this.polices,this.motos,this.powerups,this.venecas].forEach(g=>{
        g.children.each(s=>{ if(s && (s.y>GAME_H+80 || s.y<-120)) s.destroy(); });
      });
    }

    updatePoliceAI(){
      this.polices.children.iterate(pol=>{
        if(!pol) return;
        const dx=this.player.x - pol.x;
        const lat=pol.getData('lateralSpeed')||130;
        pol.setVelocityX(Phaser.Math.Clamp(dx*2,-lat,lat));
        const base=gameState.baseSpeed + 60 + gameState.level*30;
        if(pol.y < this.player.y-220) pol.setVelocityY(base+120);
        else if(pol.y > this.player.y-120) pol.setVelocityY(base-20);
        else pol.setVelocityY(base);
      });
    }
    updateMotoAI(){
      this.motos.children.iterate(m=>{
        if(!m) return;
        if(!m.getData('chase')){ m.setVelocityX(0); return; }
        const dx=this.player.x - m.x;
        const chase=100 + gameState.level*10;
        m.setVelocityX(Phaser.Math.Clamp(dx*2,-chase,chase));
      });
    }

    // NUEVO: Patrones de movimiento √∫nicos para nuevas botellas
    updateBottlePatterns(){
      // Tapa Verde - Zigzag
      this.tapaverdes.children.iterate(bottle => {
        if(!bottle) return;
        const zigzagData = bottle.getData('zigzag');
        if(zigzagData) {
          const elapsed = this.time.now * zigzagData.frequency;
          const offsetX = Math.sin(elapsed) * zigzagData.amplitude;
          bottle.x = Phaser.Math.Clamp(zigzagData.baseX + offsetX, 50, 430);
        }
      });
      
      // Club Dorada - Ya tiene movimiento diagonal por velocityX
      this.clubdoradas.children.iterate(bottle => {
        if(!bottle) return;
        // Rebote en bordes
        if(bottle.x <= 50 || bottle.x >= 430) {
          bottle.setVelocityX(bottle.body.velocity.x * -1);
        }
      });
      
      // Aguardiente Real - Rebote lateral
      this.aguardientes.children.iterate(bottle => {
        if(!bottle) return;
        const bounceData = bottle.getData('bounce');
        if(bounceData) {
          bottle.setVelocityX(bounceData.speed * bounceData.direction);
          if(bottle.x <= 50) {
            bottle.setData('bounce', {speed: bounceData.speed, direction: 1});
          } else if(bottle.x >= 430) {
            bottle.setData('bounce', {speed: bounceData.speed, direction: -1});
          }
        }
      });
    }

    gameOver(){ this.scene.start('GameOver',{score:gameState.score, stats: gameState.stats}); }
  }

  /* ================== GAME OVER ================== */
  class GameOver extends Phaser.Scene{
    constructor(){super('GameOver')}
    init(data){ 
      this.finalScore=data?.score||0; 
      this.finalStats=data?.stats||{};
    }
    create(){
      this.add.tileSprite(GAME_W/2,GAME_H/2,GAME_W,GAME_H,'road');
      this.add.text(GAME_W/2,60,'GAME OVER',{fontSize:'44px',fill:'#ffdddd',stroke:'#700',strokeThickness:8}).setOrigin(0.5);
      this.add.text(GAME_W/2,120,`PUNTOS: ${this.finalScore}`,{fontSize:'24px',fill:'#fff',stroke:'#000',strokeThickness:4}).setOrigin(0.5);
      
      // NUEVO: Mostrar estad√≠sticas detalladas
      const stats = this.finalStats;
      this.add.text(GAME_W/2,170,'ESTAD√çSTICAS',{fontSize:'20px',fill:'#00ffff',stroke:'#001d1d',strokeThickness:3}).setOrigin(0.5);
      
      this.add.text(GAME_W/2,200,`üèçÔ∏è Venecas recogidas: ${stats.venecasRecogidas || 0}`,{fontSize:'16px',fill:'#ffff80'}).setOrigin(0.5);
      this.add.text(GAME_W/2,220,`üíä Powerups recogidos: ${stats.powerupsRecogidos || 0}`,{fontSize:'16px',fill:'#80ff80'}).setOrigin(0.5);
      this.add.text(GAME_W/2,240,`üç∫ Cervezas chocadas: ${stats.cervezasChocadas || 0}`,{fontSize:'16px',fill:'#ff8080'}).setOrigin(0.5);
      this.add.text(GAME_W/2,260,`üëÆ Polic√≠as esquivados: ${stats.policiasEsquivados || 0}`,{fontSize:'16px',fill:'#8080ff'}).setOrigin(0.5);
      this.add.text(GAME_W/2,280,`üí• Polic√≠as chocados: ${stats.policiasChocados || 0}`,{fontSize:'16px',fill:'#ff4040'}).setOrigin(0.5);

      const btn=this.add.text(GAME_W/2,340,'REINTENTAR',{fontSize:'22px',fill:'#ffff00',backgroundColor:'#006600',padding:{x:20,y:10},stroke:'#fff',strokeThickness:1})
        .setOrigin(0.5).setInteractive({useHandCursor:true});
      btn.on('pointerdown',()=>this.scene.start('Game'));
      const menu=this.add.text(GAME_W/2,390,'MEN√ö',{fontSize:'20px',fill:'#ffff00',backgroundColor:'#333300',padding:{x:15,y:8},stroke:'#fff',strokeThickness:1})
        .setOrigin(0.5).setInteractive({useHandCursor:true});
      menu.on('pointerdown',()=>this.scene.start('MainMenu'));
    }
  }

  /* ================== CONFIG: escala m√≥vil ================== */
  new Phaser.Game({
    type: Phaser.AUTO,
    parent: 'gameContainer',
    backgroundColor: '#002233',
    physics:{ default:'arcade', arcade:{ debug:false }},
    scene:[Preload,MainMenu,Game,GameOver],
    scale: {
      mode: Phaser.Scale.FIT,         // ajusta a la pantalla manteniendo aspecto
      autoCenter: Phaser.Scale.CENTER_BOTH,
      width: GAME_W,
      height: GAME_H,
      min: { width: 320, height: 480 } // seguridad en m√≥viles muy peque√±os
    }
  });
  </script>
</body>
</html>